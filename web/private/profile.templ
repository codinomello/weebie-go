package private

import (
    "time"

    components "github.com/codinomello/weebie-go/web/components"
    "github.com/codinomello/weebie-go/api/models"
)

type User *models.User

templ Profile(user User) {
    <html lang="pt-BR" class="scroll-smooth">
    <head>
        <!-- Meta Tags -->
        @components.Meta()
        <!-- T√≠tulo -->
        @components.Title("Weebie - Meu Perfil")
        <!-- HTMX e Tailwind CSS -->
        @components.ScriptHead()
        <!-- Fonte -->
        @components.StyleHead()
        <!-- Flowbite CSS e √çcone -->
        @components.Link("house_with_garden.png")
        <!-- Firebase SDK -->
        <script type="module">
            import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js';
            import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js';

            const firebaseConfig = {
                apiKey: "AIzaSyAI0Tc7GssKwWwtVdrz6OaK6KFACx58N5U",
                authDomain: "weebie-go.firebaseapp.com",
                projectId: "weebie-go",
                storageBucket: "weebie-go.appspot.com",
                messagingSenderId: "321509944065",
                appId: "1:321509944065:web:199a546b7055f461ec4900",
                measurementId: "G-S5CG0CLRVS"
            };

            console.log('Inicializando Firebase...');
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            console.log('Firebase inicializado com sucesso');

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log('‚úÖ Usu√°rio logado:', {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL || 'Nenhuma foto de perfil dispon√≠vel'
                    });

                    // Verifica se o usu√°rio est√° autenticado via Google
                    const isGoogleUser = user.providerData.some(profile => profile.providerId === 'google.com');
                    if (isGoogleUser && user.photoURL) {
                        console.log('üì∏ Foto de perfil do Google:', user.photoURL);
                    } else if (isGoogleUser) {
                        console.log('‚ö†Ô∏è Usu√°rio Google sem foto de perfil definida');
                    } else {
                        console.log('‚ö†Ô∏è Usu√°rio n√£o autenticado via Google');
                    }
                } else {
                    console.log('‚ùå Nenhum usu√°rio logado');
                }
            });

            window.checkAuth = () => {
                const user = auth.currentUser;
                console.log('Usu√°rio atual:', user ? {
                    uid: user.uid,
                    email: user.email,
                    photoURL: user.photoURL || 'Nenhuma foto'
                } : 'Nenhum');
            };
            console.log('üí° Use window.checkAuth() no console para verificar o usu√°rio');
        </script>
    </head>
    <body class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 text-gray-900 dark:text-gray-100 transition-colors duration-300">
        <!-- Navega√ß√£o  -->
        @components.Nav("Meu Perfil", "house_with_garden.png")
        
        <section>
        <!-- Conte√∫do Principal -->
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row gap-8">
                <!-- Sidebar/Info B√°sica -->
                <div class="w-full md:w-80">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sticky top-6">
                        <div class="text-center mb-6">
                            <div class="w-24 h-24 mx-auto rounded-full bg-blue/10 flex items-center justify-center text-4xl mb-3">
                                { getUserInitial(user.Name) }
                            </div>
                            <h2 class="text-xl font-bold text-orange dark:text-golden">{ user.Name }</h2>
                            <p class="text-gray-500 dark:text-gray-400 text-sm">{ user.Role }</p>
                            
                            <div class="mt-4 flex justify-center gap-2">
                                <span class="bg-green/10 text-green dark:bg-green/20 dark:text-green/80 px-3 py-1 rounded-full text-xs">
                                    { user.Status }
                                </span>
                                <span class="bg-blue/10 text-blue dark:bg-blue/20 dark:text-blue/80 px-3 py-1 rounded-full text-xs">
                                    Membro desde { formatDate(user.CreatedAt) }
                                </span>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">Contato</h4>
                                <p class="dark:text-gray-300">{ user.Email }</p>
                                if user.Phone != "" {
                                    <p class="dark:text-gray-300">{ user.Phone }</p>
                                }
                            </div>
                            
                            if user.Address != "" {
                                <div>
                                    <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">Endere√ßo</h4>
                                    <p class="dark:text-gray-300">
                                        { user.Address }, { user.Number }<br>
                                        if user.Complement != "" {
                                            { user.Complement }<br>
                                        }
                                        { user.Neighborhood }<br>
                                        { user.City } - { user.State }<br>
                                        CEP: { formatCEP(user.CEP) }
                                    </p>
                                </div>
                            }
                            
                            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                                <button class="w-full bg-blue text-white py-2 rounded-lg hover:bg-blue/80 transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center gap-2">
                                    <span>‚úèÔ∏è</span> Editar Perfil
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conte√∫do Principal -->
                <div class="flex-1">
                    <!-- Se√ß√£o de Informa√ß√µes Pessoais -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                        <h3 class="text-xl font-bold text-orange dark:text-golden mb-6">Informa√ß√µes Pessoais</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">Nome Completo</h4>
                                <p class="dark:text-gray-300">{ user.Name }</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">G√™nero</h4>
                                <p class="dark:text-gray-300">
                                    if user.Sex == "male" {
                                        Masculino
                                    } else if user.Sex == "female" {
                                        Feminino
                                    } else if user.Sex == "other" {
                                        Outro
                                    } else {
                                        N√£o informado
                                    }
                                </p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">Idade</h4>
                                <p class="dark:text-gray-300">
                                    if user.Age > 0 {
                                        { user.Age } anos
                                    } else {
                                        N√£o informada
                                    }
                                </p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">CPF</h4>
                                <p class="dark:text-gray-300">
                                    if user.CPF != "" {
                                        { formatCPF(user.CPF) }
                                    } else {
                                        N√£o informado
                                    }
                                </p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">RG</h4>
                                <p class="dark:text-gray-300">
                                    if user.RG != "" {
                                        { user.RG }
                                    } else {
                                        N√£o informado
                                    }
                                </p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-sm text-gray-500 dark:text-gray-400">Termos Aceitos</h4>
                                <p class="dark:text-gray-300">
                                    if user.Terms {
                                        <span class="text-green">‚úì Sim</span>
                                    } else {
                                        <span class="text-red">‚úó N√£o</span>
                                    }
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Se√ß√£o de Atividades -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-orange dark:text-golden">Minhas Atividades</h3>
                            <div class="flex gap-2">
                                <button class="text-sm bg-blue text-white px-3 py-1 rounded hover:bg-blue/80 transition">
                                    Projetos
                                </button>
                                <button class="text-sm border border-gray-300 px-3 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                                    Contribui√ß√µes
                                </button>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- Exemplo de atividade -->
                            <div class="p-4 border rounded-lg hover:shadow-md transition">
                                <div class="flex items-start gap-3">
                                    <div class="text-blue text-xl">üå±</div>
                                    <div>
                                        <h4 class="font-semibold dark:text-gray-200">Voc√™ criou um novo projeto</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Horta Comunit√°ria - 3 dias atr√°s</p>
                                        <p class="mt-2 text-sm dark:text-gray-300">Projeto de cultivo coletivo iniciado no bairro Jardim das Flores</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Adicione mais atividades conforme necess√°rio -->
                        </div>
                    </div>
                    
                    <!-- Se√ß√£o de Seguran√ßa -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-orange dark:text-golden mb-6">Seguran√ßa da Conta</h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-4 border rounded-lg">
                                <div>
                                    <h4 class="font-semibold dark:text-gray-200">Alterar Senha</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">√öltima altera√ß√£o: { formatDate(user.UpdatedAt) }</p>
                                </div>
                                <button class="text-blue hover:underline">Alterar</button>
                            </div>
                            
                            <div class="flex justify-between items-center p-4 border rounded-lg">
                                <div>
                                    <h4 class="font-semibold dark:text-gray-200">Sess√µes Ativas</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Dispositivos com acesso √† sua conta</p>
                                </div>
                                <button class="text-blue hover:underline">Gerenciar</button>
                            </div>
                            
                            <div class="p-4 border border-red/20 rounded-lg bg-red/5">
                                <h4 class="font-semibold text-red dark:text-red/80 mb-2">Encerrar Conta</h4>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Esta a√ß√£o √© irrevers√≠vel. Todos os seus dados ser√£o removidos permanentemente.</p>
                                <button class="text-sm border border-red text-red px-3 py-1 rounded hover:bg-red/10 transition">
                                    Encerrar minha conta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </section>
        <!-- Footer -->
        @components.FooterMain()
    </body>
    </html>
}

// Fun√ß√µes auxiliares (implementar no seu backend)
func getUserInitial(name string) string {
    if len(name) > 0 {
        return string(name[0])
    }
    return "?"
}

func formatDate(date time.Time) string {
    return date.Format("02/01/2006")
}

func formatCPF(cpf string) string {
    if len(cpf) != 11 {
        return cpf
    }
    return cpf[:3] + "." + cpf[3:6] + "." + cpf[6:9] + "-" + cpf[9:]
}

func formatCEP(cep string) string {
    if len(cep) != 8 {
        return cep
    }
    return cep[:5] + "-" + cep[5:]
}