package public

import (
    "time"

    components "github.com/codinomello/weebie-go/web/components"
)

templ Project() {
    <html lang="pt-BR">
    <head>
        <!-- Meta Tags -->
        @components.Meta()
        <!-- T√≠tulo -->
        @components.Title("Weebie - Cadastro de Projetos")
        <!-- HTMX e Tailwind CSS -->
        @components.ScriptHead()
        <!-- Fonte -->
        @components.StyleHead()
        <!-- √çcone -->
        @components.Link("house_with_garden.png")
    </head>
    <body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex flex-col">
        <!-- Header -->
        @components.Nav("Cadastro de Projetos", "house_buildings.png")
        
        <!-- Formul√°rio -->
        <main class="flex-grow container mx-auto px-4 py-8 max-w-3xl">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-xl border border-gray-200 dark:border-gray-700">
                <h1 class="text-3xl font-bold text-center mb-8 text-orange dark:text-golden">
                    <span class="text-blue">üìã</span> Cadastro de Projeto
                </h1>
                
                <form hx-post="/projects" hx-swap="none" class="space-y-8">
                    <!-- Se√ß√£o de Informa√ß√µes B√°sicas -->
                    <div class="p-6 rounded-xl bg-blue bg-opacity-20 border-l-4 border-blue shadow-md">
                        <h2 class="text-2xl font-bold text-blue mb-6 flex items-center gap-3">
                            <span class="text-3xl">üìù</span> Informa√ß√µes B√°sicas
                        </h2>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- IDs ocultos -->
                            <input type="hidden" name="id" id="project-id">
                            <input type="hidden" name="owner_id" id="owner-id">
                            
                            <!-- T√≠tulo -->
                            <div class="space-y-2">
                                <label for="title" class="block text-md font-medium text-gray-700 dark:text-gray-300">T√≠tulo do Projeto*</label>
                                <input type="text" id="title" name="title" required maxlength="100"
                                       class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue focus:border-transparent transition"
                                       placeholder="Nome do seu projeto">
                                <p class="text-xs text-gray-500 dark:text-gray-400">M√°ximo 100 caracteres</p>
                            </div>

                            <!-- Ano -->
                            <div class="space-y-2">
                                <label for="year" class="block text-md font-medium text-gray-700 dark:text-gray-300">Ano*</label>
                                <input type="number" id="year" name="year" min="2000" max="@{currentYear()+5}" required
                                       class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue focus:border-transparent transition"
                                       value="@{currentYear()}">
                            </div>
                        </div>
                    </div>

                    <!-- Se√ß√£o de Detalhes -->
                    <div class="p-6 rounded-xl bg-pink bg-opacity-20 border-l-4 border-pink shadow-md">
                        <h2 class="text-2xl font-bold text-pink mb-6 flex items-center gap-3">
                            <span class="text-3xl">‚ú®</span> Detalhes do Projeto
                        </h2>
                        
                        <div class="space-y-6">
                            <!-- Descri√ß√£o -->
                            <div class="space-y-2">
                                <label for="details" class="block text-md font-medium text-gray-700 dark:text-gray-300">Descri√ß√£o*</label>
                                <textarea id="details" name="details" rows="4" required maxlength="1000"
                                    class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-pink focus:border-transparent transition"
                                    placeholder="Descreva seu projeto em detalhes"></textarea>
                                <p class="text-xs text-gray-500 dark:text-gray-400">M√°ximo 1000 caracteres</p>
                            </div>

                            <!-- Impacto -->
                            <div class="space-y-2">
                                <label for="impact" class="block text-md font-medium text-gray-700 dark:text-gray-300">Impacto Esperado*</label>
                                <textarea id="impact" name="impact" rows="3" required maxlength="500"
                                    class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-pink focus:border-transparent transition"
                                    placeholder="Qual impacto positivo seu projeto ter√°?"></textarea>
                                <p class="text-xs text-gray-500 dark:text-gray-400">M√°ximo 500 caracteres</p>
                            </div>

                            <!-- √çcone e Status -->
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- √çcone -->
                                <div class="space-y-2">
                                    <label for="icon" class="block text-md font-medium text-gray-700 dark:text-gray-300">√çcone do Projeto</label>
                                    <select id="icon" name="icon"
                                        class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-pink focus:border-transparent transition">
                                        <option value="">Selecione um √≠cone</option>
                                        <option value="üå±">üå± Sustentabilidade</option>
                                        <option value="üí°">üí° Inova√ß√£o</option>
                                        <option value="üë•">üë• Comunidade</option>
                                        <option value="üè•">üè• Sa√∫de</option>
                                        <option value="üéì">üéì Educa√ß√£o</option>
                                        <option value="üåç">üåç Meio Ambiente</option>
                                        <option value="üîß">üîß Tecnologia</option>
                                    </select>
                                </div>
                                
                                <!-- Status -->
                                <div class="space-y-2">
                                    <label for="status" class="block text-md font-medium text-gray-700 dark:text-gray-300">Status*</label>
                                    <select id="status" name="status" required
                                        class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-pink focus:border-transparent transition">
                                        <option value="active" selected>Ativo</option>
                                        <option value="completed">Conclu√≠do</option>
                                        <option value="archived">Arquivado</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Se√ß√£o de Classifica√ß√£o -->
                    <div class="p-6 rounded-xl bg-green bg-opacity-20 border-l-4 border-green shadow-md">
                        <h2 class="text-2xl font-bold text-green mb-6 flex items-center gap-3">
                            <span class="text-3xl">üè∑Ô∏è</span> Classifica√ß√£o
                        </h2>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Curso -->
                            <div class="space-y-2">
                                <label for="course" class="block text-md font-medium text-gray-700 dark:text-gray-300">Curso*</label>
                                <select id="course" name="course" required
                                    class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-green focus:border-transparent transition">
                                    <option value="">Selecione um curso</option>
                                    <option value="Administra√ß√£o">Administra√ß√£o</option>
                                    <option value="Edifica√ß√µes">Edifica√ß√µes</option>
                                    <option value="Enfermagem">Enfermagem</option>
                                    <option value="Inform√°tica">Inform√°tica</option>
                                    <option value="Mecatr√¥nica">Mecatr√¥nica</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                            
                            <!-- Outro Curso (condicional) -->
                            <div id="other-course-container" class="space-y-2 hidden">
                                <label for="other_course" class="block text-md font-medium text-gray-700 dark:text-gray-300">Especifique o Curso*</label>
                                <input type="text" id="other_course" name="other_course"
                                    class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-green focus:border-transparent transition"
                                    placeholder="Digite o nome do curso">
                            </div>
                            
                            <!-- Membros -->
                            <div class="space-y-2 md:col-span-2">
                                <label for="members-input" class="block text-md font-medium text-gray-700 dark:text-gray-300">Adicionar Membros</label>
                                <div class="relative">
                                    <input type="email" id="members-input" 
                                        class="w-full px-4 py-2 rounded-lg dark:text-gray-300 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-green focus:border-transparent transition pr-10"
                                        placeholder="Digite e-mails dos membros (separados por v√≠rgula)">
                                    <button type="button" id="add-member-btn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-green hover:text-green-700">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                        </svg>
                                    </button>
                                </div>
                                <input type="hidden" id="members" name="members">
                                <div id="members-container" class="flex flex-wrap gap-2 mt-2"></div>
                                <p class="text-sm text-gray-600 dark:text-gray-300">Digite o e-mail e pressione Enter ou clique no bot√£o +</p>
                            </div>
                        </div>
                    </div>

                    <!-- Se√ß√£o ODS -->
                    <div class="p-6 rounded-xl bg-yellow-600 bg-opacity-20 border-l-4 border-yellow-500 shadow-md">
                        <h2 class="text-2xl font-bold text-yellow-600 dark:text-yellow-300 mb-6 flex items-center gap-3">
                            <span class="text-3xl">üåé</span> ODS Relacionados
                        </h2>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="ods-container">
                            <!-- ODS ser√£o inseridos aqui via JavaScript -->
                        </div>
                        <input type="hidden" id="ods" name="ods">
                        <p class="text-sm text-gray-600 dark:text-gray-300 mt-4">Selecione os Objetivos de Desenvolvimento Sustent√°vel relacionados ao seu projeto</p>
                    </div>

                    <!-- Modal para detalhes do ODS -->
                    <div id="ods-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-md w-full p-6 shadow-2xl">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 id="ods-modal-title" class="text-xl font-bold text-yellow-600 dark:text-yellow-300"></h3>
                                    <p id="ods-modal-number" class="text-sm text-gray-500 dark:text-gray-400"></p>
                                </div>
                                <button onclick="closeODSModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="flex justify-center mb-4">
                                <span id="ods-modal-emoji" class="text-5xl"></span>
                            </div>
                            <p id="ods-modal-description" class="text-gray-700 dark:text-gray-300"></p>
                            <div class="mt-6 flex justify-end">
                                <button onclick="closeODSModal()" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition">
                                    Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Datas (autom√°ticas) -->
                    <input type="hidden" name="created_at" id="created-at">
                    <input type="hidden" name="updated_at" id="updated-at">

                    <!-- Bot√µes -->
                    <div class="flex flex-col md:flex-row justify-end gap-4 mt-8">
                        <!-- Bot√£o limpar -->
                        <button type="button" id="clear-btn" 
                            class="px-6 py-3 bg-gray-500 text-white font-medium rounded-lg transition-all duration-150 transform hover:scale-[1.025] flex items-center gap-2 hover:bg-gray-600">
                            <span class="text-xl">üóëÔ∏è</span> Limpar Campos
                        </button>

                        <!-- Bot√£o salvar -->
                        <button type="submit" 
                            class="px-6 py-3 bg-green text-white font-medium rounded-lg transition-all duration-150 transform hover:scale-[1.025] flex items-center gap-2 hover:bg-green-600">
                            <span class="text-xl">üíæ</span> Salvar Projeto
                        </button>
                    </div>
                </form>
            </div>
        </main>
        <!-- Footer -->
        @components.FooterLogin()
        <script>
            // Lista completa de ODS definida diretamente no template
            const odsList = [
                { number: 1, emoji: 'üçΩÔ∏è', name: 'Erradica√ß√£o da Pobreza', description: 'Acabar com a pobreza em todas as suas formas, em todos os lugares.' },
                { number: 2, emoji: 'üå±', name: 'Fome Zero e Agricultura Sustent√°vel', description: 'Acabar com a fome, alcan√ßar a seguran√ßa alimentar e promover a agricultura sustent√°vel.' },
                { number: 3, emoji: 'üíä', name: 'Sa√∫de e Bem-Estar', description: 'Assegurar uma vida saud√°vel e promover o bem-estar para todos.' },
                { number: 4, emoji: 'üìö', name: 'Educa√ß√£o de Qualidade', description: 'Garantir educa√ß√£o inclusiva e equitativa de qualidade.' },
                { number: 5, emoji: 'üë©‚Äç‚ù§Ô∏è‚Äçüë®', name: 'Igualdade de G√™nero', description: 'Alcan√ßar a igualdade de g√™nero e empoderar todas as mulheres e meninas.' },
                { number: 6, emoji: 'üíß', name: '√Ågua Pot√°vel e Saneamento', description: 'Garantir disponibilidade e manejo sustent√°vel da √°gua.' },
                { number: 7, emoji: '‚ö°', name: 'Energia Limpa e Acess√≠vel', description: 'Garantir acesso √† energia acess√≠vel, confi√°vel e sustent√°vel.' },
                { number: 8, emoji: 'üíº', name: 'Trabalho Decente e Crescimento Econ√¥mico', description: 'Promover o crescimento econ√¥mico sustentado e o trabalho decente.' },
                { number: 9, emoji: 'üè≠', name: 'Ind√∫stria, Inova√ß√£o e Infraestrutura', description: 'Construir infraestrutura resiliente e promover a industrializa√ß√£o sustent√°vel.' },
                { number: 10, emoji: '‚öñÔ∏è', name: 'Redu√ß√£o das Desigualdades', description: 'Reduzir a desigualdade dentro e entre os pa√≠ses.' },
                { number: 11, emoji: 'üåÜ', name: 'Cidades e Comunidades Sustent√°veis', description: 'Tornar as cidades e os assentamentos humanos inclusivos, seguros e sustent√°veis.' },
                { number: 12, emoji: '‚ôªÔ∏è', name: 'Consumo e Produ√ß√£o Respons√°veis', description: 'Garantir padr√µes de consumo e produ√ß√£o sustent√°veis.' },
                { number: 13, emoji: 'üå°Ô∏è', name: 'A√ß√£o Contra a Mudan√ßa Global do Clima', description: 'Tomar medidas urgentes para combater a mudan√ßa clim√°tica.' },
                { number: 14, emoji: 'üêü', name: 'Vida na √Ågua', description: 'Conservar e usar de forma sustent√°vel os oceanos e recursos marinhos.' },
                { number: 15, emoji: 'üå≥', name: 'Vida Terrestre', description: 'Proteger, restaurar e promover o uso sustent√°vel dos ecossistemas terrestres.' },
                { number: 16, emoji: 'üïäÔ∏è', name: 'Paz, Justi√ßa e Institui√ß√µes Eficazes', description: 'Promover sociedades pac√≠ficas e inclusivas para o desenvolvimento sustent√°vel.' },
                { number: 17, emoji: 'ü§ù', name: 'Parcerias e Meios de Implementa√ß√£o', description: 'Fortalecer os meios de implementa√ß√£o e revitalizar a parceria global.' }
            ];

            document.addEventListener('DOMContentLoaded', () => {
                // Configurar campos autom√°ticos
                const now = new Date().toISOString();
                document.getElementById('created-at').value = now;
                document.getElementById('updated-at').value = now;
                
                // Mostrar campo "Outro Curso" quando selecionado
                const courseSelect = document.getElementById('course');
                const otherCourseContainer = document.getElementById('other-course-container');
                
                courseSelect.addEventListener('change', () => {
                    if (courseSelect.value === 'Outro') {
                        otherCourseContainer.classList.remove('hidden');
                        document.getElementById('other_course').required = true;
                    } else {
                        otherCourseContainer.classList.add('hidden');
                        document.getElementById('other_course').required = false;
                    }
                });
                
                // Gerenciamento de membros
                const membersInput = document.getElementById('members-input');
                const membersHidden = document.getElementById('members');
                const membersContainer = document.getElementById('members-container');
                const addMemberBtn = document.getElementById('add-member-btn');
                
                // Adicionar membro ao pressionar Enter ou v√≠rgula
                membersInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ',') {
                        e.preventDefault();
                        addMember();
                    }
                });
                
                // Adicionar membro ao clicar no bot√£o +
                addMemberBtn.addEventListener('click', addMember);
                
                function addMember() {
                    const email = membersInput.value.trim();
                    
                    // Validar e-mail
                    if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                        // Verificar se j√° existe
                        const existingEmails = Array.from(membersContainer.querySelectorAll('.member-tag'))
                            .map(tag => tag.dataset.email.toLowerCase());
                            
                        if (existingEmails.includes(email.toLowerCase())) {
                            showError('Este e-mail j√° foi adicionado');
                            return;
                        }
                        
                        // Criar tag do membro
                        const memberTag = document.createElement('div');
                        memberTag.className = 'member-tag flex items-center bg-green-100 dark:bg-green-900 px-3 py-1 rounded-full text-sm';
                        memberTag.dataset.email = email;
                        memberTag.innerHTML = `
                            <span class="text-green-800 dark:text-green-200">${email}</span>
                            <button type="button" class="ml-2 text-green-600 dark:text-green-300 hover:text-green-800 dark:hover:text-green-100" onclick="removeMember(this)">
                                √ó
                            </button>
                        `;
                        
                        membersContainer.appendChild(memberTag);
                        membersInput.value = '';
                        updateMembersHidden();
                    } else {
                        showError('Por favor, insira um e-mail v√°lido');
                    }
                }
                
                // Fun√ß√£o global para remover membros
                window.removeMember = function(button) {
                    button.parentElement.remove();
                    updateMembersHidden();
                };
                
                function updateMembersHidden() {
                    const emails = Array.from(membersContainer.querySelectorAll('.member-tag')).map(tag => tag.dataset.email);
                    membersHidden.value = JSON.stringify(emails);
                }
                
                function showError(message) {
                    // Remover erros anteriores
                    const existingError = document.getElementById('email-error');
                    if (existingError) existingError.remove();
                    
                    // Criar elemento de erro
                    const errorElement = document.createElement('p');
                    errorElement.id = 'email-error';
                    errorElement.className = 'text-red-500 text-xs mt-1';
                    errorElement.textContent = message;
                    
                    // Inserir ap√≥s o input
                    membersInput.parentNode.insertBefore(errorElement, membersInput.nextSibling);
                    
                    // Remover ap√≥s 3 segundos
                    setTimeout(() => {
                        errorElement.remove();
                    }, 3000);
                }

                // Gerenciamento de ODS
                const odsContainer = document.getElementById('ods-container');
                const odsHidden = document.getElementById('ods');
                
                odsList.forEach(ods => {
                    const odsCard = document.createElement('label');
                    odsCard.className = 'flex items-center p-3 rounded-lg bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-200 dark:border-gray-600 transition cursor-pointer';
                    
                    odsCard.innerHTML = `
                        <input type="checkbox" name="ods_checkbox" value="${ods.number}" 
                               class="ods-checkbox w-5 h-5 text-yellow-600 border-yellow-300 rounded focus:ring-yellow-500 dark:bg-gray-800 dark:border-gray-600">
                        <span class="ml-3 text-sm font-medium text-gray-700 dark:text-gray-300">
                            ${ods.emoji} ODS ${ods.number}
                        </span>
                        <button type="button" onclick="showODSDetails(${ods.number})" class="ml-auto text-gray-400 hover:text-yellow-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </button>
                    `;
                    
                    odsContainer.appendChild(odsCard);
                });
                
                // Atualizar ODS hidden quando checkboxes mudam
                document.addEventListener('change', (e) => {
                    if (e.target.classList.contains('ods-checkbox')) {
                        const selectedODS = Array.from(document.querySelectorAll('.ods-checkbox:checked')).map(cb => cb.value);
                        odsHidden.value = JSON.stringify(selectedODS);
                    }
                });

                // Limpar formul√°rio
                document.getElementById('clear-btn').addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja limpar todos os campos?')) {
                        document.querySelector('form').reset();
                        membersContainer.innerHTML = '';
                        membersHidden.value = '';
                        odsHidden.value = '';
                        document.querySelectorAll('.ods-checkbox').forEach(cb => cb.checked = false);
                        otherCourseContainer.classList.add('hidden');
                    }
                });
            });
            
            // Fun√ß√£o para mostrar detalhes do ODS
            window.showODSDetails = function(odsNumber) {
                const ods = odsList.find(o => o.number === odsNumber.toString());
                if (ods) {
                    document.getElementById('ods-modal-title').textContent = ods.title;
                    document.getElementById('ods-modal-number').textContent = `ODS ${ods.number}`;
                    document.getElementById('ods-modal-emoji').textContent = ods.emoji;
                    document.getElementById('ods-modal-description').textContent = ods.description;
                    document.getElementById('ods-modal').classList.remove('hidden');
                }
            };
            
            // Fun√ß√£o para fechar modal ODS
            window.closeODSModal = function() {
                document.getElementById('ods-modal').classList.add('hidden');
            };
        </script>
    </body>
    </html>
}

func currentYear() int {
    return time.Now().Year()
}