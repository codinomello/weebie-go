package components

templ ScriptHead() {
    @ScriptHeadSource()
    @ScriptHeadTailwindConfig()
}

templ ScriptBody() {
    @ScriptBodyFirebase()
    @ScriptBodyDarkMode()
    @ScriptBodySource()
}

templ ScriptHeadSource() {
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
}

templ ScriptHeadTailwindConfig() {
    <script>
        tailwind.config = {
          darkMode: 'class',
          theme: {
            extend: {
              colors: {
                // Cores primÃ¡rias
                red: '#FF0000',    // Vermelho
                green: '#32CD32',  // Verde
                blue: '#00BFFF',   // Azul
                lilac: '#C8A2C8',  // LilÃ¡s
                pink: '#FF1493',   // Rosa
                orange: '#FF6F00', // Laranja
                golden: '#FFD700', // Ouro

                // Cores sucundÃ¡rias
                brown: '#8B4513',  // Marrom
                teal: '#40E0D0',   // Turquesa
                silver: '#C0C0C0', // Prata
                copper: '#B87333', // Cobre
              }
            }
          }
        }
    </script>
}

templ ScriptHeadODSList() {
    <script>
        const odsList = [
            { number: 1, emoji: 'ğŸ½ï¸', name: 'ErradicaÃ§Ã£o da Pobreza', description: 'Acabar com a pobreza em todas as suas formas, em todos os lugares.' },
            { number: 2, emoji: 'ğŸŒ±', name: 'Fome Zero e Agricultura SustentÃ¡vel', description: 'Acabar com a fome, alcanÃ§ar a seguranÃ§a alimentar e promover a agricultura sustentÃ¡vel.' },
            { number: 3, emoji: 'ğŸ’Š', name: 'SaÃºde e Bem-Estar', description: 'Assegurar uma vida saudÃ¡vel e promover o bem-estar para todos.' },
            { number: 4, emoji: 'ğŸ“š', name: 'EducaÃ§Ã£o de Qualidade', description: 'Garantir educaÃ§Ã£o inclusiva e equitativa de qualidade.' },
            { number: 5, emoji: 'ğŸ‘©â€â¤ï¸â€ğŸ‘¨', name: 'Igualdade de GÃªnero', description: 'AlcanÃ§ar a igualdade de gÃªnero e empoderar todas as mulheres e meninas.' },
            { number: 6, emoji: 'ğŸ’§', name: 'Ãgua PotÃ¡vel e Saneamento', description: 'Garantir disponibilidade e manejo sustentÃ¡vel da Ã¡gua.' },
            { number: 7, emoji: 'âš¡', name: 'Energia Limpa e AcessÃ­vel', description: 'Garantir acesso Ã  energia acessÃ­vel, confiÃ¡vel e sustentÃ¡vel.' },
            { number: 8, emoji: 'ğŸ’¼', name: 'Trabalho Decente e Crescimento EconÃ´mico', description: 'Promover o crescimento econÃ´mico sustentado e o trabalho decente.' },
            { number: 9, emoji: 'ğŸ­', name: 'IndÃºstria, InovaÃ§Ã£o e Infraestrutura', description: 'Construir infraestrutura resiliente e promover a industrializaÃ§Ã£o sustentÃ¡vel.' },
            { number: 10, emoji: 'âš–ï¸', name: 'ReduÃ§Ã£o das Desigualdades', description: 'Reduzir a desigualdade dentro e entre os paÃ­ses.' },
            { number: 11, emoji: 'ğŸŒ†', name: 'Cidades e Comunidades SustentÃ¡veis', description: 'Tornar as cidades e os assentamentos humanos inclusivos, seguros e sustentÃ¡veis.' },
            { number: 12, emoji: 'â™»ï¸', name: 'Consumo e ProduÃ§Ã£o ResponsÃ¡veis', description: 'Garantir padrÃµes de consumo e produÃ§Ã£o sustentÃ¡veis.' },
            { number: 13, emoji: 'ğŸŒ¡ï¸', name: 'AÃ§Ã£o Contra a MudanÃ§a Global do Clima', description: 'Tomar medidas urgentes para combater a mudanÃ§a climÃ¡tica.' },
            { number: 14, emoji: 'ğŸŸ', name: 'Vida na Ãgua', description: 'Conservar e usar de forma sustentÃ¡vel os oceanos e recursos marinhos.' },
            { number: 15, emoji: 'ğŸŒ³', name: 'Vida Terrestre', description: 'Proteger, restaurar e promover o uso sustentÃ¡vel dos ecossistemas terrestres.' },
            { number: 16, emoji: 'ğŸ•Šï¸', name: 'Paz, JustiÃ§a e InstituiÃ§Ãµes Eficazes', description: 'Promover sociedades pacÃ­ficas e inclusivas para o desenvolvimento sustentÃ¡vel.' },
            { number: 17, emoji: 'ğŸ¤', name: 'Parcerias e Meios de ImplementaÃ§Ã£o', description: 'Fortalecer os meios de implementaÃ§Ã£o e revitalizar a parceria global.' }
        ];
    </script>
}

templ ScriptBodyFirebase() {
    <script>
        // ConfiguraÃ§Ã£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAI0Tc7GssKwWwtVdrz6OaK6KFACx58N5U",
            authDomain: "weebie-go.firebaseapp.com",
            projectId: "weebie-go",
            storageBucket: "weebie-go.firebasestorage.app",
            messagingSenderId: "321509944065",
            appId: "1:321509944065:web:199a546b7055f461ec4900",
            measurementId: "G-S5CG0CLRVS"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Referencias DOM
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const userInfo = document.getElementById('user-info');
        const loading = document.getElementById('loading');
        const profilePic = document.getElementById('profile-picture');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const userId = document.getElementById('user-id');
        
        // Evento de login
        loginButton.addEventListener('click', async () => {
            try {
                loading.style.display = 'block';
                
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await firebase.auth().signInWithPopup(provider);
                
                // UsuÃ¡rio logado com sucesso
                const user = result.user;
                console.log("UsuÃ¡rio autenticado:", user);
                
                // Obter token
                const idToken = await user.getIdToken();
                
                // Enviar token para backend
                await verifyWithBackend(idToken);
            } catch (error) {
                console.error("Erro de autenticaÃ§Ã£o:", error);
                alert(`Erro ao fazer login: ${error.message}`);
                loading.style.display = 'none';
            }
        });
        
        // Evento de logout
        logoutButton.addEventListener('click', () => {
            firebase.auth().signOut();
            hideUserInfo();
        });
        
        // Enviar token para o backend Go
        async function verifyWithBackend(idToken) {
            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${idToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Falha na autenticaÃ§Ã£o com o backend');
                }
                
                console.log("AutenticaÃ§Ã£o verificada pelo backend:", data);
                
                // Exibir informaÃ§Ãµes do usuÃ¡rio
                displayUserInfo(data);
            } catch (error) {
                console.error("Erro na verificaÃ§Ã£o com backend:", error);
                alert(`Erro na verificaÃ§Ã£o: ${error.message}`);
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // Exibir informaÃ§Ãµes do usuÃ¡rio
        function displayUserInfo(userData) {
            profilePic.src = userData.picture || '';
            userName.textContent = userData.name || 'UsuÃ¡rio';
            userEmail.textContent = userData.email || '';
            userId.textContent = userData.uid || '';
            
            userInfo.style.display = 'block';
            loginButton.style.display = 'none';
        }
        
        // Esconder informaÃ§Ãµes do usuÃ¡rio
        function hideUserInfo() {
            userInfo.style.display = 'none';
            loginButton.style.display = 'block';
        }
        
        // Verificar estado da autenticaÃ§Ã£o quando a pÃ¡gina carrega
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                try {
                    loading.style.display = 'block';
                    const idToken = await user.getIdToken();
                    await verifyWithBackend(idToken);
                } catch (error) {
                    console.error("Erro ao verificar token:", error);
                    loading.style.display = 'none';
                }
            } else {
                hideUserInfo();
            }
        });
    </script>
}

templ ScriptBodyDarkMode() {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          const themeToggle = document.getElementById('theme-toggle');
          const html = document.documentElement;
          
          // Verificar preferÃªncia salva
          const savedTheme = localStorage.getItem('theme') || 'light';
          html.classList.toggle('dark', savedTheme === 'dark');
        
          themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
            updateThemeIcon();
          });
        
          function updateThemeIcon() {
            const isDark = html.classList.contains('dark');
            themeToggle.querySelectorAll('svg').forEach(icon => {
              icon.classList.toggle('hidden', isDark ? icon.getAttribute('fill') === '#fff' : icon.getAttribute('fill') !== '#fff');
            });
          }
          updateThemeIcon();
        });
    </script>
}

templ ScriptBodySource() {
    <!-- Import do Firebase via CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- ImportaÃ§Ã£o do Flowbite.js via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"></script>
}

templ ScriptGetCurrentYear() {
    <script>
        // Ano atual
        var years = document.getElementsByClassName("current-year");
        Array.from(years).forEach(year => {
            year.innerHTML = new Date().getFullYear();
        });
    </script>
}